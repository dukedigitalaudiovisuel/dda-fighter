<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>DDA Street Fighter</title>
<style>
body {
    margin:0;
    background:#000;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
#gameWrapper {
    border:4px solid gold;
    border-radius:25px;
    overflow:hidden;
}
canvas {
    background:#222;
    display:block;
}
</style>
</head>
<body>

<div id="gameWrapper">
    <canvas id="dda-fight" width="900" height="500"></canvas>
</div>

<script>
/* ===============================
   JEU STREET FIGHTER DDA SIMPLIFIÉ
   =============================== */

var canvas = document.getElementById("dda-fight");
var ctx = canvas.getContext("2d");

var GROUND_Y = 420;
var GRAVITY = 0.7;

var keys = {};
var gameState = "fight";

function createFighter(name, role, color, accent, side) {
  var baseX = (side === "left") ? 200 : 700;
  return {
    name: name,
    role: role,
    color: color,
    accent: accent,
    side: side,
    x: baseX,
    y: GROUND_Y,
    w: 40,
    h: 70,
    vx: 0,
    vy: 0,
    onGround: true,
    health: 100,
    attacking: false,
    attackTimer: 0,
    hitCooldown: 0
  };
}

// Personnages
var player1 = createFighter("DDA", "Indépendant", "#444466", "#FF44AA", "left");
var player2 = createFighter("Patron Major", "Industrie", "#111111", "#FFD700", "right");

window.addEventListener("keydown", function(e){
  keys[e.key.toLowerCase()] = true;
});
window.addEventListener("keyup", function(e){
  keys[e.key.toLowerCase()] = false;
});

function updateFight() {
  player1.vx = 0;
  if (keys["q"]) player1.vx = -3;
  if (keys["d"]) player1.vx = 3;

  if ((keys["z"] || keys["arrowup"]) && player1.onGround) {
    player1.vy = -13;
    player1.onGround = false;
  }

  if (keys[" "] && !player1.attacking) {
    player1.attacking = true;
    player1.attackTimer = 10;
  }

  // IA joueur 2
  var distance = player1.x - player2.x;
  player2.vx = (distance > 0 ? 2 : -2);

  if (Math.abs(distance) < 80) {
    if (!player2.attacking) {
      player2.attacking = true;
      player2.attackTimer = 10;
    }
  }

  applyPhysics(player1);
  applyPhysics(player2);

  handleAttacks(player1, player2);
  handleAttacks(player2, player1);
}

function applyPhysics(f) {
  f.x += f.vx;
  f.y += f.vy;

  if (f.x < 50) f.x = 50;
  if (f.x > canvas.width - 50) f.x = canvas.width - 50;

  f.vy += GRAVITY;
  if (f.y >= GROUND_Y) {
    f.y = GROUND_Y;
    f.vy = 0;
    f.onGround = true;
  }

  if (f.attacking) {
    f.attackTimer--;
    if (f.attackTimer <= 0) f.attacking = false;
  }

  if (f.hitCooldown > 0) f.hitCooldown--;
}

function handleAttacks(attacker, defender) {
  if (!attacker.attacking || attacker.hitCooldown > 0) return;

  var dir = (attacker.side === "left") ? 1 : -1;
  var hit = {
    x: attacker.x + dir * 40,
    y: attacker.y - attacker.h + 20,
    w: 30,
    h: 30
  };

  var target = {
    x: defender.x - defender.w/2,
    y: defender.y - defender.h,
    w: defender.w,
    h: defender.h
  };

  if (hit.x < target.x + target.w &&
      hit.x + hit.w > target.x &&
      hit.y < target.y + target.h &&
      hit.h + hit.y > target.y) {

      defender.health -= 10;
      if (defender.health < 0) defender.health = 0;

      attacker.hitCooldown = 20;
  }
}

function drawBackground() {
  ctx.fillStyle = "#111";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "#303030";
  ctx.fillRect(0, GROUND_Y, canvas.width, 200);
}

function drawFighter(f) {
  var x = f.x - f.w/2;
  var y = f.y - f.h;

  ctx.fillStyle = "rgba(0,0,0,0.6)";
  ctx.beginPath();
  ctx.ellipse(f.x, f.y, 30, 8, 0, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle = f.color;
  ctx.fillRect(x, y, f.w, f.h);

  ctx.fillStyle = f.accent;
  ctx.fillRect(x+6, y-18, f.w-12, 18);
}

function drawHealthBars() {
  ctx.fillStyle = "#FFD700";
  ctx.fillRect(20, 20, player1.health * 3, 20);

  ctx.fillStyle = "#FFD700";
  ctx.fillRect(900 - (player2.health * 3) - 20, 20, player2.health * 3, 20);
}

function loop() {
  updateFight();
  drawBackground();
  drawFighter(player1);
  drawFighter(player2);
  drawHealthBars();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
